package com.cgt.mentor.slot.dao;

import java.util.List;

import javax.persistence.EntityManager;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;
import org.springframework.transaction.annotation.Transactional;

import com.cgt.mentor.slot.entity.MentorSlot;
import com.cgt.mentor.slot.facade.MentorSlotDao;

@Repository
@Transactional
public class MentorSlotDaoImpl implements MentorSlotDao {

	@Autowired
	private EntityManager entity;
	
	public List<MentorSlot> getAllSlot() {
		
		List<MentorSlot> list = this.entity.createQuery("From MentorSlot").getResultList();
		
		return list;
	}

	public MentorSlot getSlotById(Integer id) {
		
		MentorSlot slot = this.entity.find(MentorSlot.class,id);
		
		return slot;
	}

	public boolean saveSlot(MentorSlot slot) {
		
		System.out.println("Save Slot : "+slot);
		//this.entity.persist(slot);
		
		return true;
	}

	public boolean updateSlot(MentorSlot slot) {
		
		MentorSlot s = this.entity.find(MentorSlot.class,slot.getId());
		
		s.setMentorId(slot.getMentorId());
		s.setTimeFrom(slot.getTimeFrom().toString());
		s.setTimeTo(slot.getTimeTo().toString());
		
		this.entity.flush();
		
		return true;
	}

	public boolean deleteSlot(Integer id) {

		MentorSlot slot = this.entity.find(MentorSlot.class,id);
		this.entity.remove(slot);
		
		return true;
	}

	public List<MentorSlot> getMentorById(Integer id) {
		
		List<MentorSlot> list = this.entity.createQuery("From MentorSlot Where mentorId="+id).getResultList();
		//List<MentorSlot> list = this.entity.createNativeQuery("SELECT * FROM `mentor_slots` WHERE id not in(select slot_id from training where mentor_id in(select mentor_id from mentorskills where technology_id="+id+"))",MentorSlot.class).getResultList();
		
		return list;
	}
}
